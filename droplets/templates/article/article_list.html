<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <!-- title和keywords -->
    <title>{{ articles.0.categories.all.0.name }}相关新闻 - {{ site.title }}</title>
    <meta name="Keywords" content="{{ site.keywords }}">
    <meta name="Description" content="{{ site.desc }}">

    <!-- 通用meta配置 -->
    <meta http-equiv="mobile-agent" content="format=xhtml; url={{ site.wap_site }}">
    <meta http-equiv="mobile-agent" content="format=html5; url={{ site.wap_site }}">

    <!-- 通用css -->
    <link rel="stylesheet" type="text/css" href="/static/css/index-two.css">

    <!-- 通用js -->
    <script src="/static/js/jquery.min.js"></script>
  </head>

  <body>
    <!--首页header-->
    {% include "header.html" %}

    <!--首页main-->
    <!-- main begin -->
    <div class="fm-index-main">
      <!--新闻列表-->
    <div class="in-news">
      <div class="news-list" style="" id="n0">
        <ul id="masonry0" class="masonry" style="position: relative; min-height: 2640px">
          {% for cur_news in articles %}
          <li class="masonry-brick" style="left: 0px; overflow: hidden">
          <div class="pad">
            <div class="n-pic fl">
              <a href="/{{cur_news.categories.all.0.dir_name}}{{cur_news.plural}}" title="{{cur_news.title}}"><img src="{{cur_news.pic}}" alt="{{cur_news.title}}"></a>
            </div>
            <div class="n-text fl">
              <h4><a href="{{cur_news.categories.all.0.dir_name}}{{cur_news.plural}}" title="{{cur_news.title}}">{{cur_news.title}}</a></h4>
              <div class="n-des">{{cur_news.brief|safe}}</div>
              <div class="clear"></div>
              <div class="n-keytime">
                <div class="time fr">{{cur_news.created_on|date:"Y-m-d"}}</div>
                <div class="clear"></div>
              </div>
            </div>
          </div></li>

          {% endfor %}
        </ul>
      </div>
    </div>
    <div class="clear" id="cl"></div>
      <!--右侧topic-->
      {% include "in-side.html" %}
  </div>
</div>
    {% include "footer.html" %}
    <div id="sss"></div>
  </body>
</html>


<script>
var page = 1;
var flag = true;

$(window).bind("scroll", function(event){
  var thisButtomTop = parseInt($(window).height()) + parseInt($(window).scrollTop());
  var thisTop = parseInt($(window).scrollTop());
  var PictureTop = parseInt($("#sss").offset().top); // 底部的一个ID
  if (PictureTop >= thisTop && PictureTop <= thisButtomTop) {
    if (flag) {
      page ++;
      flag = false;
      var dir_name = "{{cate.dir_name}}";
      url = "/get_article_by_page/?" + "page=" + page + "&dir_name=" + dir_name;
      $.ajax({
        url: url,
        type: 'get',
        datatype: 'json',
        success: function(data){
          var len = data.length;
          if (len > 100) {
            setTimeout(function () {
              // 先移除该元素
              //$("#sss").remove();
              // 添加page，修改height
              //var height = 182 * page * 10;
              //if (height < 1920) {
              //  height = 1920;
              //}
              //$("#masonry0").css("height", height + "px");

              // 写入元素
              $("#masonry0").append(data);
            }, 2000);
          }
          flag = true;
        }})
    }
  }})
</script>
